// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider          = "postgresql"
    url               = env("PRISMA_CONNECTION_STRING") // uses connection pooling
    directUrl         = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
    shadowDatabaseUrl = env("POSTGRES_URL_NON_POOLING") // used for migrations
}

model User {
    id       String  @id @default(uuid())
    username String  @unique
    email    String  @unique
    password String
    admin    Boolean @default(false)

    posts     Post[]         @relation("PostsCreatedBy")
    revisions PostRevision[] @relation("UserPostRevision")
}

model Post {
    id String @id @default(uuid())

    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    removedAt DateTime?

    createdById String
    createdBy   User   @relation("PostsCreatedBy", fields: [createdById], references: [id])

    revisions PostRevision[] @relation()

    title      String
    undertitle String
    content    String
}

model PostRevision {
    revisionId String @id @default(uuid())

    post   Post   @relation(fields: [postId], references: [id])
    postId String

    field String
    value String

    description String?

    createdAt DateTime @default(now())

    createdById String
    createdBy   User   @relation("UserPostRevision", fields: [createdById], references: [id])
}
